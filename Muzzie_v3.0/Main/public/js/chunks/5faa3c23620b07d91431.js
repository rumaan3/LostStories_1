(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{224:function(n,e,t){var s=t(441);"string"==typeof s&&(s=[[n.i,s,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};t(6)(s,a);s.locals&&(n.exports=s.locals)},440:function(n,e,t){"use strict";t(224)},441:function(n,e,t){(n.exports=t(5)(!1)).push([n.i,".chats-wrapper[data-v-35cba5d5]{min-width:350px;max-width:500px;position:relative;min-height:40vh;border-radius:10px;padding:.5rem}@media screen and (max-width:500px){.chats-wrapper[data-v-35cba5d5]{min-width:auto}}.chats-wrapper .title-wrapper[data-v-35cba5d5]{padding-left:.5em}.chats-wrapper ul[data-v-35cba5d5]{list-style:none}.chats-wrapper ul li[data-v-35cba5d5]{padding:.5rem .3rem;border-radius:5px;border-radius:15px;word-break:break-all;display:flex;cursor:pointer}.chats-wrapper ul li .avatar[data-v-35cba5d5]{margin-right:1rem}.chats-wrapper ul li .avatar img[data-v-35cba5d5]{border-radius:50%;width:3em}.chats-wrapper ul li .infos[data-v-35cba5d5]{flex-grow:2}.chats-wrapper ul li .infos .name-unread[data-v-35cba5d5]{display:flex;align-items:center}.chats-wrapper ul li .infos .name-unread .name[data-v-35cba5d5]{font-weight:600;margin-right:1em;max-width:100%}.chats-wrapper ul li .infos .name-unread .unread-messages-count[data-v-35cba5d5]{height:1.6em;width:1.6em;font-weight:600;display:flex;justify-content:center;align-items:center;border-radius:50%;background-color:purple;font-size:.55em}.chats-wrapper ul li .infos .last_message[data-v-35cba5d5]{opacity:.8}.chats-wrapper ul li .infos .unread[data-v-35cba5d5]{color:purple;font-weight:600}.chats-wrapper ul li[data-v-35cba5d5]:hover{background-color:hsla(0,0%,42%,.26)}",""])},698:function(n,e,t){"use strict";t.r(e);var s=t(12),a=t.n(s);function i(n,e,t,s,a,i,r){try{var o=n[i](r),d=o.value}catch(n){return void t(n)}o.done?e(d):Promise.resolve(d).then(s,a)}var r={props:["whoToOpen","amIAlive"],components:{MessageComponent:function(){return t.e(29).then(t.bind(null,706))}},data:function(){return{currentOpenChat:null,friends:this.$store.getters.getFriends,isLoading:!1}},methods:{close:function(n){if(n){var e=this.friends.findIndex((function(e){return e.id==n.id}));this.friends[e].session.open=!1}this.currentOpenChat=null},openChat:function(n){this.isLoading=!0,n.session?(this.friends.forEach((function(n){return n.session?n.session.open=!1:""})),n.session.open=!0,this.currentOpenChat=n,n.session.unreadCount=0,this.isLoading=!1):this.createSession(n)},createSession:function(n){var e=this;axios.post("/api/sessions/create",{friend_id:n.id}).then((function(t){n.session=t.data,n.session.open=!0,e.currentOpenChat=n,e.isLoading=!1}))},listenForEverySession:function(n){var e=this;window.Echo.private("Chat.".concat(n.session.id)).listen("PrivateChatEvent",(function(t){n.session.open||(e.amIAlive||e.$emit("unread",1),n.session.unreadCount++,n.session.last_message[0].content=t.content)}))}},computed:{isThereASession:function(){return this.friends.some((function(n){return n.session}))}},created:function(){var n,e=this;return(n=a.a.mark((function n(){var t;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.whoToOpen&&(e.openChat(e.friends.find((function(n){return n.id==e.whoToOpen}))),e.$emit("chatOpened")),e.friends.forEach((function(n){e.listenForEverySession(n)})),t=e.friends.reduce((function(n,e){return n+e.session.unreadCount}),0),e.amIAlive||e.$emit("unread",t),window.Echo.channel("Chat").listen("HearingEvent",(function(n){var t=e.friends.find((function(e){return e.id==n.user_id}));t&&(t.isPlaying=n.is_playing)})),window.Echo.channel("Chat").listen("SessionEvent",(function(n){e.friends.find((function(e){return e.id==n.session_by})).session=n.session}));case 6:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(s,a){var r=n.apply(e,t);function o(n){i(r,s,a,o,d,"next",n)}function d(n){i(r,s,a,o,d,"throw",n)}o(void 0)}))})()},watch:{whoToOpen:function(n){n&&(this.openChat(this.friends.find((function(e){return e.id==n}))),this.$emit("chatOpened"))},amIAlive:function(n){n||this.close(this.currentOpenChat)}}},o=(t(440),t(0)),d=t(1),c=t.n(d),u=t(105),l=Object(o.a)(r,(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-card",{staticClass:"chats-wrapper absolute-panel",attrs:{rounded:"lg"}},[t("div",{staticClass:"card-title-medium"},[n._v(n._s(n.$t("Chats")))]),n._v(" "),n.isLoading?t("div",{staticClass:"loading"},[n._v(n._s(n.$t("Opening chat...Please wait!")))]):t("div",{staticClass:"chats"},[n.isThereASession?t("ul",[n._l(n.friends,(function(e){return[e.session?t("li",{key:e.id,on:{click:function(t){return n.openChat(e)}}},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:e.avatar,alt:""}})]),n._v(" "),t("div",{staticClass:"infos"},[t("div",{staticClass:"name-unread"},[t("div",{staticClass:"name max-1-lines"},[n._v(n._s(e.name))]),n._v(" "),e.session.unreadCount>0?t("div",{staticClass:"unread-messages-count"},[n._v("\n                                "+n._s(e.session.unreadCount)+"\n                            ")]):n._e()]),n._v(" "),e.session.last_message.length?t("div",{staticClass:"last_message",class:{unread:e.session.unreadCount>0}},[n._v("\n                            "+n._s(e.session.last_message[0].content)+"\n                        ")]):n._e()])]):n._e()]}))],2):t("empty-page",{attrs:{headline:n.$t("No chats to show!"),sub:n.$t("Add some friends and start chatting!")}})],1),n._v(" "),n.currentOpenChat?[t("message-component",{attrs:{friend:n.currentOpenChat},on:{close:function(e){return n.close(n.currentOpenChat)}}})]:n._e()],2)}),[],!1,null,"35cba5d5",null);e.default=l.exports;c()(l,{VCard:u.a})}}]);